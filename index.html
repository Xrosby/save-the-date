<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Save the Date</title>
    <!-- Include Oridomi library -->
    <script src="https://oridomi.com/oridomi.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <script src="dynamics.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Afacad:wght@400;500;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">


</head>

<body>
    <div id="container">
        <div id="card">

            <div id="stars" class="stars"></div>


            <div style="position:fixed;bottom:-30vh; width:100vw;height:80vh;" id="sunset-container"></div>
            <div style="position:fixed;bottom:-30vh;left:10vw; width:80vw;height:80vh;" id="sunset-container2"></div>

            <div id="save-the-date-container" style="display:flex">
                <h1 class="text" id="save-header-save">SAVE</h1>
                <h1 class="text" id="save-header-the">the</h1>
                <h1 class="text" id="save-header-date">DATE</h1>
            </div>
            <div id="balloon">
                <img style="height:100%;width:100%;" src="hot-air-balloon-21225.png" />
            </div>
            <div id="cloud1" style="height: 3rem; width: 5rem">
                <img style="height:100%;width:100%;" src="cloud.png" />
            </div>
            <div id="cloud2" style="height:4rem; width: 6rem">
                <img style="height:100%;width:100%;" src="cloud.png" />
            </div>
            <div id="cloud3" style="height:6rem; width: 8rem">
                <img style="height:100%;width:100%;" src="cloud.png" />
            </div>
            <div>
                <div id="date">
                    <span class="text number" id="number-1" style="z-index: 105; padding-top:3rem;padding-bottom:5px">17</span>

                    <span class="text number"
                        style="z-index: 105;border-bottom:1px solid black; border-top:1px solid black; margin-bottom: 10px; padding-top:10px">08</span>

                    <span class="text number" style="z-index: 105;">24</span>

                </div>
                <div id="names" style="display:flex">
                    <span class="text" style="z-index: 105;">Mads</span>
                    <div class="ring-container">
                        <div style="z-index: 105;" class="ring"></div>
                        <div style="z-index: 105;" class="ring2"></div>
                    </div>
                    <span class="text" style="z-index: 105;">Nica</span>
                </div>

            </div>
            <div id="formal-invitation">
                <span class="text" style="z-index: 105;">Castello di San Basilio, Pisticci</span>
                <!--<span class="text" id="message" style="z-index: 105;margin-top:1rem">Seguirà invito ufficiale</span>-->
                <!--<span class="text" id="message" style="z-index: 105;">Official invitation følger</span>-->
            </div>

            <div id="hills">
                <img style="height:100%; width:100%" src="hills2.png" />
            </div>

        </div>

    </div>




    <script>

        /*

                    HANDLE STARS
        */

        var nightsky = ["#280F36", "#632B6C", "#BE6590", "#FFC1A0", "#FE9C7F"];


        var star0 =
            "<div class='star star-0' style='top:{{top}}vh;left:{{left}}vw;animation-duration:{{duration}}s;'></div>";

        var star1 =
            "<div class='star star-1 blink' style='top:{{top}}vh;left:{{left}}vw;animation-duration:{{duration}}s;'></div>";

        var star2 =
            "<div class='star star-2 blink' style='top:{{top}}vh;left:{{left}}vw;animation-duration:{{duration}}s;'></div>";

        var star3 =
            "<div class='star star-3' style='top:{{top}}vh;left:{{left}}vw;animation-duration:{{duration}}s;'></div>";

        var star4 =
            "<div class='star star-4 blink' style='top:{{top}}vh;left:{{left}}vw;animation-duration:{{duration}}s;'></div>";

        var star5 =
            "<div class='star star-5' style='top:{{top}}vh;left:{{left}}vw;animation-duration:{{duration}}s;background-color:{{color}}'></div>";



        var star1pt =
            "<div class='star star-1 blink' style='top:{{top}}%;left:{{left}}%;animation-duration:{{duration}}s;background-color:{{color}};box-shadow:0px 0px 6px 1px {{shadow}}'></div>";

        var star2pt =
            "<div class='star star-2' style='top:{{top}}%;left:{{left}}%;animation-duration:{{duration}}s;background-color:{{color}};box-shadow:0px 0px 10px 1px {{shadow}};opacity:0.7'></div>";

        var blur =
            "<div class='blur' style='top:{{top}}%;left:{{left}}%;background-color:{{color}}'></div>";

        for (i = 0; i < 100; i++) {
            $(".stars").append(
                star1
                    .replace("{{top}}", getRandomInt(0, 40))
                    .replace("{{left}}", getRandomInt(0, 100))
                    .replace("{{duration}}", getRandomInt(2, 5))
            );

            $(".stars").append(
                star2
                    .replace("{{top}}", getRandomInt(20, 70))
                    .replace("{{left}}", getRandomInt(0, 100))
                    .replace("{{duration}}", getRandomInt(4, 8))
            );
        }

        for (i = 0; i < 50; i++) {
            $(".stars").append(
                star0
                    .replace("{{top}}", getRandomInt(0, 50))
                    .replace("{{left}}", getRandomInt(0, 100))
                    .replace("{{duration}}", getRandomInt(1, 2.5))
            );

            $(".stars").append(
                star1
                    .replace("{{top}}", getRandomInt(0, 50))
                    .replace("{{left}}", getRandomInt(0, 100))
                    .replace("{{duration}}", getRandomInt(2.5, 4))
            );

            $(".stars").append(
                star2
                    .replace("{{top}}", getRandomInt(0, 50))
                    .replace("{{left}}", getRandomInt(0, 100))
                    .replace("{{duration}}", getRandomInt(4, 5))
            );
        }

        for (i = 0; i < 20; i++) {
            $(".stars").append(
                star0
                    .replace("{{top}}", getRandomInt(40, 75))
                    .replace("{{left}}", getRandomInt(0, 100))
                    .replace("{{duration}}", getRandomInt(1, 3))
            );

            $(".stars").append(
                star1
                    .replace("{{top}}", getRandomInt(40, 75))
                    .replace("{{left}}", getRandomInt(0, 100))
                    .replace("{{duration}}", getRandomInt(2, 4))
            );
        }

        for (i = 0; i < 30; i++) {
            $(".stars").append(
                star0
                    .replace("{{top}}", getRandomInt(0, 100))
                    .replace("{{left}}", getRandomInt(0, 100))
                    .replace("{{duration}}", getRandomInt(1, 2))
            );

            $(".stars").append(
                star1
                    .replace("{{top}}", getRandomInt(0, 100))
                    .replace("{{left}}", getRandomInt(0, 100))
                    .replace("{{duration}}", getRandomInt(2, 5))
            );

            $(".stars").append(
                star2
                    .replace("{{top}}", getRandomInt(0, 100))
                    .replace("{{left}}", getRandomInt(0, 100))
                    .replace("{{duration}}", getRandomInt(1, 4))
            );

            $(".stars").append(
                star4
                    .replace("{{top}}", getRandomInt(0, 70))
                    .replace("{{left}}", getRandomInt(0, 100))
                    .replace("{{duration}}", getRandomInt(5, 7))
            );
        }






        function getRandomInt(min, max) {
            return Math.random() * (max - min) + min;
        }



        /**
         * 
         * 
         * 
         */
        // Function to interpolate between two colors based on a percentage (t)
        function interpolateColor(color1, color2, t) {
            const hex = function (x) {
                x = x.toString(16);
                return (x.length === 1) ? '0' + x : x;
            };

            // Parse colors
            const r1 = parseInt(color1.slice(1, 3), 16);
            const g1 = parseInt(color1.slice(3, 5), 16);
            const b1 = parseInt(color1.slice(5, 7), 16);

            const r2 = parseInt(color2.slice(1, 3), 16);
            const g2 = parseInt(color2.slice(3, 5), 16);
            const b2 = parseInt(color2.slice(5, 7), 16);

            // Interpolate each component
            const r = Math.round(r1 * (1 - t) + r2 * t);
            const g = Math.round(g1 * (1 - t) + g2 * t);
            const b = Math.round(b1 * (1 - t) + b2 * t);

            return '#' + hex(r) + hex(g) + hex(b);
        }

        // Function to calculate brightness based on color
        function interpolatedColorBrightness(color) {
            // Parse colors
            const r = parseInt(color.slice(1, 3), 16);
            const g = parseInt(color.slice(3, 5), 16);
            const b = parseInt(color.slice(5, 7), 16);

            // Calculate brightness (luma)
            return (0.299 * r + 0.587 * g + 0.114 * b) / 255;
        }
        // Function to calculate sunset gradient color based on time
        function calculateSunsetColor(hours, minutes, seconds) {
            // Calculate the total number of seconds since 6 PM
            const totalSeconds = hours * 3600 + minutes * 60 + seconds;

            // Calculate the percentage of time passed since 6 PM (in a 6-hour window)
            const timePercentage = Math.min(Math.max((totalSeconds - 18 * 3600) / (6 * 3600), 0), 1);

            // Adjust the color values based on your desired sunset gradient
            const sunsetRed = Math.round(255 - timePercentage * 100); // Adjusted to make it more yellowish
            const sunsetGreen = Math.round(150 + timePercentage * 100); // Adjusted to make it more orangish
            const sunsetBlue = 0;

            return `rgb(${sunsetRed}, ${sunsetGreen}, ${sunsetBlue})`;
        }

        // Function to calculate the dynamic percentage for linear-gradient based on hours, minutes, and seconds
        function calculateGradientPercentage(hours, minutes, seconds) {
            // Adjust the percentage based on your desired range
            if (hours >= 17 && hours < 24) {
                // Gradually reduce the percentage from 0% to 90% between 5 PM and 9 PM
                const totalMinutes = 1//(hours - 17) * 60 + minutes + seconds / 60;
                return (totalMinutes / (4 * 60));
            } else {
                // For other times, set it to 50%
                return 10;
            }
        }

        function setDynamicBackgroundColor() {
            // Get the current time
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();


            // Calculate color based on time
            let blue = 0;
            $('#stars').css('display', 'none')
            if (hours >= 18) {
                $('#sunset-container2').css('display', 'none')
                if (hours >= 20) $('#stars').css('display', 'block')
                if (hours >= 21) {
                    $('#card').css('background', '#000')//, `linear-gradient(to top, ${sunsetColor} ${0}%, ${interpolatedColor} 100%)`);
                    $('.text').css('color', '#fff');
                    $('.number').css('border-color', '#fff')
                }
                else {
                    // If it's between 5 PM and 9 PM, start transitioning towards dark
                    const transitionHours = hours - 17;
                    blue = Math.round((transitionHours * 3600 + minutes * 60 + seconds) / (4 * 3600) * 255);
                    //console.log(blue)
                    // Calculate the dynamic percentage for linear-gradient
                    const gradientPercentage = calculateGradientPercentage(hours, minutes, seconds);

                    // Interpolate between lightest blue and black
                    const interpolatedColor = interpolateColor('#a2d5ff', '#000000', blue / 255);
                    const sunsetColor = calculateSunsetColor(hours, minutes, seconds);
                    //console.log(sunsetColor)
                    // Calculate darkness based on the blue component of the interpolated background color
                    const darkness = interpolatedColorBrightness(interpolatedColor);

                    // Adjust text color based on darkness
                    const textColor = (darkness < 0.5) ? '#FFFFFF' : '#000000';
                    $('.text').css({ 'color': textColor, 'border-color': textColor });
                    // Set the background color of the element with ID "yourElementId"
                    $('#card').css('background', interpolatedColor)//, `linear-gradient(to top, ${sunsetColor} ${0}%, ${interpolatedColor} 100%)`);

                    // Set the height of the element with ID "sunset-container" based on gradient percentage
                    const sunsetContainerHeight = calculateSunsetContainerHeight(hours, minutes, seconds);
                    //console.log(sunsetContainerHeight)
                    const h = `-${Math.floor(sunsetContainerHeight)}vh`
                    console.log(h)
                    //$('#sunset-container').css('background', `linear-gradient(to top, ${sunsetColor} ${0}%, ${interpolatedColor} 100%)`);
                    $('#sunset-container').css({
                        'display': 'block',
                        'bottom': h,
                        'width': '140vw',
                        'height': '40vh',
                        'border-radius': '50%',
                        'box-shadow': `-10px -10px 40px 5px #fff, -0px 100px 80px 200px  #fff, -0px -30px 60px 20px  #fff, -0px -50px 500px 50px  #fff`,
                        'background-color': '#ffc1a0',
                        'z-index': '1',
                        'left': '10vw'  // Added left property as per your example
                    });
                    $('#sunset-container2').css({
                        'display': 'block',
                        'bottom': h,
                        'width': '140vw',
                        'height': '35vh',
                        'border-radius': '50%',
                        'box-shadow': `-0px -10px 40px 5px ${sunsetColor}, -0px -10px 80px 20px ${sunsetColor}, -0px -100px 500px 20px #d27ba6, -0px -50px 150px 75px #7d4d8a`,
                        'background-color': '#ffc1a0',
                        'z-index': '1',
                        'left': '10vw'  // Added left property as per your example
                    });
                }
            }



        }

        function calculateSunsetContainerHeight(hours, minutes, seconds) {
            // Combine hours, minutes, and seconds into a single time value
            const totalSeconds = hours * 3600 + minutes * 60 + seconds;

            // Convert to a percentage value and subtract from 100
            // Adjust the multiplier based on your desired range
            const heightPercentage = (totalSeconds / (24 * 3600)) * 80;
            const res = Math.max(100 - heightPercentage, 1);
            //console.log(res)
            return 100 - (res + 30)
        }

        const setClouds = () => {
            // Get the current time
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();

            // Calculate total time elapsed in seconds since 18:00
            const timeElapsed = (hours - 18) * 3600 + minutes * 60 + seconds;

            const cloudLeft = $('#cloud1');
            const cloudCenter = $('#cloud3');
            const cloudRight = $('#cloud2');
            const currentPosLeft = cloudLeft.position().left;
            const currentPosCenter = cloudCenter.position().left;
            const currentPosRight = cloudRight.position().left;

            if (hours >= 18) {
                const moveDistance = timeElapsed * 0.05;
                console.log(moveDistance);
                cloudCenter.css('left', currentPosCenter - moveDistance + 'px');
                cloudLeft.css('left', currentPosLeft - moveDistance + 'px');
                cloudRight.css('left', currentPosRight + moveDistance + 'px');
            }
        };


        $('#stars').css('display', 'none')
        const setDynamicElements = () => {
            // setClouds()
            //setDynamicBackgroundColor()
        }

        //setDynamicElements()
        //setInterval(setDynamicElements, 1000)


        function floatAnimation(top) {
            let tipped = false;

            const bobbingAmplitude = 50;
            // Animate the balloon's top and left properties with a bobbing effect
            $('#balloon').animate({
                top: top,
                left: window.innerWidth - 100
            }, {
                duration: 20000,
                easing: 'swing',
                step: function (now, fx) {
                    if (fx.prop === 'top') {
                        $(this).css('top', top + bobbingAmplitude * Math.sin(now / 100));
                    } else {
                        $(this).css('bottom', top + bobbingAmplitude * Math.sin(now / 100));
                    }
                },
                complete: function () {
                    $('#balloon').animate({
                        left: 0,
                        top: top + 50,
                    }, {
                        duration: 20000,
                        easing: 'swing',
                        step: function (now, fx) {
                            if (fx.prop === 'top') {
                                $(this).css('top', top + bobbingAmplitude * Math.sin(now / 100));
                            } else {
                                $(this).css('bottom', top + bobbingAmplitude * Math.sin(now / 100));
                            }
                        },
                        complete: () => floatAnimation(top + 50)
                    });
                }
            });

        }

        /*

          const balloon = $('#balloon') //.position();
                    const firstNumber = $('#number-1')

                    function isColliding($element1, $element2) {
                        // Get positions and dimensions of the elements
                        var rect1 = $element1[0].getBoundingClientRect();
                        var rect2 = $element2[0].getBoundingClientRect();

                        return (
                            rect1.x < rect2.x + rect2.width &&
                            rect1.x + rect1.width - 35 > rect2.x &&
                            rect1.y < rect2.y + rect2.height &&
                            rect1.y + rect1.height > rect2.y
                        );
                    }
        */

        // Start the animation with an initial top value of 100
        floatAnimation(100);



        async function getCountry() {
            let country = 'italy';
            try {
                const response = await fetch('http://api.ipstack.com/check?access_key=aff86d7313e111cac1330a4236d5e53e');
                const data = await response.json();
                //alert(data.country_name)
                country = (data?.country_name || 'Italy').toLowerCase()
            } catch (error) {
                //alert('Error fetching data from ipstack API:' + JSON.stringify(error))
                console.error('Error fetching data from ipstack API:', error);
            }

            return country;
        }

        const setFormalMessage = () => {
            const country = getCountry().then((country) => {
                const danishMessage = 'Official invitation foelger'
                const italianMessage = 'Seguira\' invito ufficiale'

                const message = country === 'denmark' ? danishMessage : italianMessage;

                const formalMessageContainer = document.getElementById("message");
                formalMessageContainer.innerText = message;
            })
        }

        //setFormalMessage()

    </script>
</body>

</html>